<#include "../include/header.html">
<!--
    * @description: 模拟选配
    * @author: yanjie.zhang@hand-china.com
    * @date 2017/07/23
    * @version:0.1
-->
    <style>
        .box-col label {
            display: inline-block;
            width: 8em;
            padding-right: .8em;
        }

        .box-col li {
            padding-bottom: .3em;
        }
    </style>
    <script src="${base.contextPath}/common/code?relationGroup=HAP_RM_RELATE_GROUP"
            type="text/javascript"></script>
    <script src="${base.contextPath}/common/code?rmTypeCode=HAP_RM_TYPE_CODE"
            type="text/javascript"></script>
    <script src="${base.contextPath}/common/code?relationRm=HAP_RM_RELATION_CODE"
            type="text/javascript"></script>
    <script type="text/javascript">
        var viewModel = kendo.observable({
            model: {
            },
            createFunction: function () {
                $('#Grid').data('kendoGrid').addRow();
            },
            saveFunction: function () {
                $('#Grid').data('kendoGrid').saveChanges();
            },
            queryResource: function (e) {
                $('#Grid').data('kendoGrid').dataSource.page(1);
            }
        });

        //获取分屏需要的全屏参数
        function divFullScreen(){
            var width = $(window).width();//计算屏幕的宽度
            var height = $(window).height();
            $('#main').width(width-40);//设置div的宽度等于屏幕的宽度
            $('#main').height(height-20);//设置div的宽度等于屏幕的宽度
        }

        //选完选配值触发方法
        function parentChooseValue(option) {
            var window = $("#chooseValueWindow");
            window.data("kendoWindow").close();
            var valueItemId = option.itemId;
            var bomId = option.bomId;
            var platformId = option.platformId;
            viewModel.model.set("chooseValueItemId",valueItemId);
            viewModel.model.set("bomId",bomId);
            viewModel.model.set("realPlatformId",platformId);
            //当选完选配值确定后触发
            confirmChoose();
            //viewModel.model.set("")
        }
        
        //选配值选完确定逻辑
        function confirmChoose() {
            var newSegment = viewModel.model.bomId + "|" + viewModel.model.chooseItemCode;

            viewModel.model.set("newSegment",newSegment);

            $.ajax({
                type: 'POST',
                url: '${base.contextPath}/hap/mam/select/header/confirmChoose',
                dataType: "json",
                contentType: 'application/json',
                async: false,
                data:  kendo.stringify(viewModel.model),
                success: function (data) {
                    var rowData = data.rows || {};
                    if(data.success){
                        viewModel.model.set("vcode",rowData[0].vcode);
                        viewModel.model.set("headerId",rowData[0].headerId);
                        viewModel.model.set("segment",rowData[0].segment);
                        viewModel.model.set("relateGroup",rowData[0].relateGroup);
                        viewModel.model.set("setFlag",rowData[0].setFlag);
                        $("#selectResultGrid").data("kendoGrid").dataSource.page(1);
                        /*kendo.ui.showInfoDialog({
                            message: '成功'
                        });*/
                    }else{
                        kendo.ui.showErrorDialog({
                            message: data.message
                        });
                    }
                },
                error: function (data) {
                }
            });
        }

        //确定生成，完成选配
        function confirmGenerator() {
            //校验选配项是否选择正确,如果选配项已经选择过，提示确认要重新选择
            $.ajax({
                type: 'POST',
                url: '${base.contextPath}/hap/mam/select/header/validateAllChoose',
                dataType: "json",
                contentType: 'application/json',
                async: false,
                data:  kendo.stringify(viewModel.model),
                success: function (data) {
                    var rowData = data.rows || {};
                    if(data.success){
                        if(rowData[0].allChooseFlag!=null&&rowData[0].allChooseFlag){
                            $.ajax({
                                type: 'POST',
                                url: '${base.contextPath}/hap/mam/select/header/confirmGenerator',
                                dataType: "json",
                                contentType: 'application/json',
                                async: false,
                                data:  kendo.stringify(viewModel.model),
                                success: function (data) {
                                    var rowData = data.rows || {};
                                    if(data.success){
                                        viewModel.model.set("vcode",rowData[0].vcode);
                                        viewModel.model.set("headerId",rowData[0].headerId);
                                        viewModel.model.set("segment",rowData[0].segment);
                                        viewModel.model.set("relateGroup",rowData[0].relateGroup);
                                        viewModel.model.set("setFlag",rowData[0].setFlag);
                                        $("#selectResultGrid").data("kendoGrid").dataSource.page(1);
                                        kendo.ui.showInfoDialog({
                                            message: '确定生成成功'
                                        });
                                    }else{
                                        kendo.ui.showErrorDialog({
                                            message: data.message
                                        });
                                    }
                                },
                                error: function (data) {
                                }
                            });
                        }else{
                            kendo.ui.showConfirmDialog({
                                title: '提示',
                                message: '存在未选配的选配项，请确定是否生成V码?'
                            }).done(function (e) {
                                if (e.button == 'OK') {
                                    viewModel.model.set("confirmFlag","Y");
                                    $.ajax({
                                        type: 'POST',
                                        url: '${base.contextPath}/hap/mam/select/header/confirmGenerator',
                                        dataType: "json",
                                        contentType: 'application/json',
                                        async: false,
                                        data:  kendo.stringify(viewModel.model),
                                        success: function (data) {
                                            var rowData = data.rows || {};
                                            if(data.success){
                                                viewModel.model.set("vcode",rowData[0].vcode);
                                                viewModel.model.set("headerId",rowData[0].headerId);
                                                viewModel.model.set("segment",rowData[0].segment);
                                                viewModel.model.set("relateGroup",rowData[0].relateGroup);
                                                viewModel.model.set("setFlag",rowData[0].setFlag);
                                                $("#selectResultGrid").data("kendoGrid").dataSource.page(1);
                                                kendo.ui.showInfoDialog({
                                                    message: '确定生成成功'
                                                });
                                            }else{
                                                kendo.ui.showErrorDialog({
                                                    message: data.message
                                                });
                                            }
                                        },
                                        error: function (data) {
                                        }
                                    });
                                }
                            })
                        }
                    }
                },
                error: function (data) {
                }
            });
        }

    </script>
    <body>
    <div class="container" stylediv id="main">
        <div id="left" style="padding: 0px;padding-top: 10px" class="col-xs-4">
            <div class="demo-section k-content">
                <div class="box-col">
                    <ul>
                        <li style="list-style-type:none;"><label for="right" >平台选择:</label>
                            <input id="itemIdLov" required data-bind="value:model.itemId,text:model.itemName" style="width: 150px;" />
                            <script>
                                $("#itemIdLov").kendoLov($.extend(${lovProvider.getLov(base.contextPath, base.locale, "HAP_MDM_PALTFROM_CHOOSE")},{
                                    query: function(e) {
                                        /* 此处拿的是进入页面选取的平台ID*/
                                    },
                                    change:function (e) {
                                        var combobox = $("#relationCodeKB").data("kendoComboBox");
                                        combobox.setDataSource(null);
                                        viewModel.model.set("relateGroup",null);
                                        $("#treeGrid").data("kendoGrid").dataSource.page(1);
                                    },
                                    select: function(e) {
                                       // $("#itemIdLov").attr("disabled","disabled").unbind();
                                        var itemIdLov = $("#itemIdLov").data("kendoLov");
                                        itemIdLov.enable(false);
                                        viewModel.model.set("platformId",e.item.itemId);
                                        $("#treeGrid").data("kendoGrid").dataSource.page(1);
                                    }
                                }));
                            </script>
                        </li>
                        <li style="list-style-type:none;"><label for="left">约束关系选择:</label>
                            <!--关系类型-->
                            <input type="text" style="width:150px;" placeholder='<@spring.message "RmItemRelateB.relateCode"/>'
                                   id="relationCodeKB"    data-bind="value:model.relateGroup">
                            <script type="text/javascript">

                                $("#relationCodeKB").kendoComboBox({
                                    optionLabel: "----",
                                    dataSource     :null,
                                    valuePrimitive : false,
                                    dataTextField  : "meaning",
                                    dataValueField : "value",
                                    open: function(e) {
                                        if(viewModel.model.itemId!=null){
                                            var combobox = $("#relationCodeKB").data("kendoComboBox");
                                            combobox.setDataSource(relationGroup);
                                        }else{
                                            kendo.ui.showInfoDialog({
                                                message: '请先选择平台'
                                            });
                                            return;
                                        }
                                    },
                                    select: function(e) {
                                        var combobox = $("#relationCodeKB").data("kendoComboBox");
                                        combobox.enable(false);
                                        $("#left > div.demo-section.k-content > div > ul > li:nth-child(2) > span > span > span.k-icon.k-i-close").removeAttr("class");
                                        //$("#relationCodeKB").attr("disabled","disabled").unbind();
                                        var item = e.item;
                                        var text = item.text();

                                        viewModel.model.set("relateGroup",text);
                                        $("#treeGrid").data("kendoGrid").dataSource.page(1);
                                        $("#relationGrid").data("kendoGrid").dataSource.page(1);

                                    },
                                    change:function (e) {
                                        var item = e.item;
                                        var text = item.text();
                                        viewModel.model.set("relateGroup",text);
                                        $("#relationGrid").data("kendoGrid").dataSource.page(1);
                                    }
                                });

                            </script>
                        </li>
                    </ul>
                </div>
            </div>

            <div  style="height: 800px;padding: 0px;">
                <div id="treeGrid" style="height: 800px;"></div>
                <script>
                    //选配项数据源
                    var BaseUrl = _basePath;
                    dataSource = new kendo.data.DataSource({
                        transport: {
                            read: {
                                url: BaseUrl + "/hap/mam/optional/seq/selectOption",
                                type: "POST",
                                dataType: "json"
                            },
                            parameterMap: function (options, type) {
                                if (type !== "read" && options.models) {
                                    var datas = Hap.prepareSubmitParameter(options, type)
                                    return kendo.stringify(datas);
                                } else if (type === "read") {
                                    if(viewModel.model.platformId==null||viewModel.model.platformId==""){
                                        viewModel.model.set("platformId",-1);
                                    }
                                    return Hap.prepareQueryParameter(viewModel.model.toJSON(), options)
                                }
                            }
                        },
                        batch: true,
                        serverPaging: true,
                        pageSize: 10,
                        schema: {
                            data: 'rows',
                            total: 'total',
                            model: {
                                id: "headerId",
                                fields: {}
                            }
                        }
                    });

                </script>
            </div>

        </div>

        <div id="right" class="col-xs-7.5" >
            <div class="row" id="page-item-all"
                 style="position: relative; margin: 0px;height: 600px">
                <div id="page-content">
                    <!---------------------------约束关系展示begin ------------------------>
                    <div class="row" style="padding: 2px;">
                        <h4 style="float:left;margin-left: 20px">约束关系展示</h4>
                    </div>
                    <div class="panel row pre-scrollable" style="padding:0px;height: 300px;">
                        <form class="form-horizontal">
                            <div class="panel-body">
                                <div style="clear:both">
                                    <div id="relationGrid"></div>
                                    <script>
                                        var BaseUrl = _basePath;
                                        relationDataSource = new kendo.data.DataSource({
                                            transport: {
                                                read: {
                                                    url: BaseUrl + "/hap/rm/item/relate/queryRelationHeader",
                                                    type: "POST",
                                                    dataType: "json"
                                                },
                                                parameterMap: function (options, type) {
                                                    if (type !== "read" && options.models) {
                                                        var datas = Hap.prepareSubmitParameter(options, type)
                                                        return kendo.stringify(datas);
                                                    } else if (type === "read") {
                                                        if(viewModel.model.platformId==null||viewModel.model.platformId==""){
                                                            viewModel.model.set("platformId",-1);
                                                            // viewModel.model.set("relateGroup",'-1');
                                                        }
                                                        return Hap.prepareQueryParameter(viewModel.model.toJSON(), options)
                                                    }
                                                }
                                            },
                                            batch: true,
                                            serverPaging: true,
                                            pageSize: 10,
                                            schema: {
                                                data: 'rows',
                                                total: 'total',
                                                model: {
                                                    id: "headerId",
                                                    fields: {}
                                                }
                                            }
                                        });
                                        /*选配关系grid*/
                                        relationGrid= $("#relationGrid").kendoGrid({
                                            dataSource: relationDataSource,
                                            height: '250px',
                                            resizable: true,
                                            scrollable: true,
                                            navigatable: false,
                                            pageable: {
                                                pageSizes: [5, 10, 20, 50],
                                                refresh: true,
                                                buttonCount: 5
                                            },
                                            columns: [
                                                {   /*平台*/
                                                    field: "platformName",
                                                    title: '<@spring.message "map.platformname"/>',
                                                    width: 90
                                                },
                                                {   /*配置关系头属性组*/
                                                    field: "relateGroup",
                                                    title: '<@spring.message "RmItemRelateB.relateGroup"/>',
                                                    width: 78
                                                },
                                                {   /*关联配置包*/
                                                    field: "itemName2",
                                                    title: '<@spring.message "map.itemName2"/>',
                                                    width: 78
                                                },
                                                {    /*关联配置属性*/
                                                    field: "attrName2",
                                                    title: '<@spring.message "map.attrName2"/>',
                                                    width: 108
                                                },
                                                {   /* 关联属性值*/
                                                    field: "attrValueName2",
                                                    title: '<@spring.message "map.attrValueName2"/>',
                                                    width: 78
                                                },
                                                {   /*关联关系代码*/
                                                    field: "relateCode",
                                                    title: '<@spring.message "RmItemRelateB.relateCode"/>',
                                                    width: 95,
                                                    template: function(dataItem){
                                                        var v = dataItem.relateCode;
                                                        $.each(relationRm,function(i,n){
                                                            if(n.value == v){
                                                                v = n.meaning;
                                                                return v;
                                                            }
                                                        })
                                                        return v;
                                                    }
                                                },
                                                {   /*类型代码*/
                                                    field: "typeCode",
                                                    title: '类型代码',
                                                    width: 70,
                                                    template: function(dataItem){
                                                        var v = dataItem.typeCode;
                                                        $.each(rmTypeCode,function(i,n){
                                                            if(n.value == v){
                                                                v = n.meaning;
                                                                return v;
                                                            }
                                                        })
                                                        return v;
                                                    }
                                                }
                                            ],
                                            editable: false
                                        }).data('kendoGrid');
                                        //添加表格行点击事件
                                         relationGrid.table.on("click", "tr", clickRelationTr);
                                        //点击物料关系头表行触发
                                        function clickRelationTr() {
                                            var row = $(this).closest("tr");
                                            var dataItem = $('#relationGrid').data('kendoGrid').dataItem(row);
                                            if(dataItem.relateId == ""){
                                                viewModel.model.set("relateId",dataItem.relateId);
                                                $("#relationLineGrid").data("kendoGrid").dataSource.page(1);
                                            }else{
                                                viewModel.model.set("relateId",dataItem.relateId);
                                                $("#relationLineGrid").data("kendoGrid").dataSource.page(1);
                                            }
                                        }
                                    </script>
                                </div>
                            </div>
                            <div class="panel-body">
                                <div style="clear:both">
                                    <div id="relationLineGrid"></div>
                                    <script>
                                        var BaseUrl = _basePath;
                                        relationLineSource = new kendo.data.DataSource({
                                            transport: {
                                                read: {
                                                    url: BaseUrl + "/hap/rm/item/relate/line/queryReleteLine",
                                                    type: "POST",
                                                    dataType: "json"
                                                },
                                                parameterMap: function (options, type) {

                                                    if (type !== "read" && options.models) {
                                                        var datas = Hap.prepareSubmitParameter(options, type)
                                                        return kendo.stringify(datas);
                                                    } else if (type === "read") {
                                                        return Hap.prepareQueryParameter(viewModel.model.toJSON(), options)
                                                    }
                                                }
                                            },
                                            batch: true,
                                            serverPaging: true,
                                            pageSize: 10,
                                            schema: {
                                                data: 'rows',
                                                total: 'total',
                                                model: {
                                                    id: "relateLineId",
                                                    fields: {
                                                        enableFlag:{defaultValue: 'Y',type: 'boolean',checkedValue:'Y',uncheckedValue:'N'}
                                                    }
                                                }
                                            }
                                        });


                                        relationLineGrid=  $("#relationLineGrid").kendoGrid({
                                            dataSource: relationLineSource,
                                            height: '200px',
                                            rownumber:true,
                                            resizable: true,
                                            scrollable: true,
                                            navigatable: false,
                                            columnMenu:true,// 实现列显示与否
                                            reorderable:true,//调整列位置
                                            pageable: {
                                                pageSizes: [5, 10, 20, 50],
                                                refresh: true,
                                                buttonCount: 5
                                            },
                                            columns: [
                                                {   /*可配置包*/
                                                    field: "itemName",
                                                    title: '<@spring.message "map.itemname"/>',
                                                    width: 120
                                                },
                                                /*配置属性*/
                                                {
                                                    field: "attrName",
                                                    title: '<@spring.message "map.attrName"/>',
                                                    width: 120
                                                },
                                                {   /*配置属性值*/
                                                    field: "attrValueName",
                                                    title: '<@spring.message "map.attrValueName"/>',
                                                    width: 120
                                                },
                                                {  /* 生效标识*/
                                                    field: "enableFlag",
                                                    title: '<@spring.message "hap.enableflag"/>',
                                                    width: 120,
                                                    headerAttributes: {
                                                        "class": "table-header-cell",
                                                        style: "text-align: center"
                                                    },
                                                    attributes: {style: "text-align:center"},
                                                }
                                            ],
                                            editable: false
                                        }).data('kendoGrid');

                                    </script>
                                </div>

                            </div>
                        </form>
                    </div>

             <!---------------------------约束关系展示end ------------------------>
             <!---------------------------选配结果展示begin ------------------------>

                    <div class="row" style="padding: 2px;margin-top: 5px">
                        <h4 style="float:left;margin-left: 20px;">选配结果展示</h4>
                        <span class="btn btn-primary k-grid-add" style="float:right;margin-right:25px;" onclick="confirmGenerator()">确定生成</span>
                        <input type="text" data-role="maskedtextbox" style="float:right;width: 230px;margin-right:15px;height: 20px" disabled="true"
                               placeholder='V码'
                               data-bind="value:model.vcode" clsass="k-textbox">
                    </div>
                    <div style="clear:both">
                        <div id="selectResultGrid"></div>
                        <script>
                            var BaseUrl = _basePath;
                            selectDataSource = new kendo.data.DataSource({
                                transport: {
                                    read: {
                                        url: BaseUrl + "/hap/mam/select/line/query",
                                        type: "POST",
                                        dataType: "json"
                                    },
                                    parameterMap: function (options, type) {
                                        if (type !== "read" && options.models) {
                                            var datas = Hap.prepareSubmitParameter(options, type)
                                            return kendo.stringify(datas);
                                        } else if (type === "read") {
                                            if(viewModel.model.headerId==null||viewModel.model.headerId==""){
                                                viewModel.model.set("headerId",-1);
                                            }
                                            return Hap.prepareQueryParameter(viewModel.model.toJSON(), options)
                                        }
                                    }
                                },
                                batch: true,
                                serverPaging: true,
                                pageSize: 10,
                                schema: {
                                    data: 'rows',
                                    total: 'total',
                                    model: {
                                        id: "headerId",
                                        fields: {}
                                    }
                                }
                            });
                            $("#selectResultGrid").kendoGrid({
                                dataSource: selectDataSource,
                                height: '300px',
                                resizable: true,
                                scrollable: true,
                                navigatable: false,
                                pageable: {
                                    pageSizes: [5, 10, 20, 50],
                                    refresh: true,
                                    buttonCount: 5
                                },
                                columns: [
                                    {
                                        field: "potx1",
                                        title: '选配项编码',
                                        width: 100
                                    },
                                    {
                                        field: "potx2",
                                        title: '选配项描述',
                                        width: 150
                                    },
                                    {
                                        field: "itemCode",
                                        title: '选配值编码',
                                        width: 100
                                    },
                                    {
                                        field: "itemName",
                                        title: '选配值描述',
                                        width: 120
                                    },
                                    {
                                        field: "mdmItemValue.a0001Desc",
                                        title: '属性1',
                                        width: 100
                                    },
                                    {
                                        field: "mdmItemValue.a0002Desc",
                                        title: '属性2',
                                        width: 100
                                    },
                                    {
                                        field: "mdmItemValue.a0003Desc",
                                        title: '属性3',
                                        width: 100
                                    },
                                    {
                                        field: "mdmItemValue.a0004Desc",
                                        title: '属性4',
                                        width: 100
                                    },
                                    {
                                        field: "mdmItemValue.a0005Desc",
                                        title: '属性5',
                                        width: 100
                                    },
                                    {
                                        field: "mdmItemValue.a0006Desc",
                                        title: '属性6',
                                        width: 100
                                    },
                                    {
                                        field: "mdmItemValue.a0007Desc",
                                        title: '属性7',
                                        width: 100
                                    },
                                    {
                                        field: "mdmItemValue.a0008Desc",
                                        title: '属性8',
                                        width: 100
                                    },
                                    {
                                        field: "mdmItemValue.a0009Desc",
                                        title: '属性9',
                                        width: 100
                                    },
                                    {
                                        field: "mdmItemValue.a0010Desc",
                                        title: '属性10',
                                        width: 100
                                    },
                                    {
                                        field: "mdmItemValue.a0011Desc",
                                        title: '属性11',
                                        width: 100
                                    },
                                    {
                                        field: "mdmItemValue.a0012Desc",
                                        title: '属性12',
                                        width: 100
                                    },
                                    {
                                        field: "mdmItemValue.a0013Desc",
                                        title: '属性13',
                                        width: 100
                                    },
                                    {
                                        field: "mdmItemValue.a0014Desc",
                                        title: '属性14',
                                        width: 100
                                    },
                                    {
                                        field: "mdmItemValue.a0015Desc",
                                        title: '属性15',
                                        width: 100
                                    },
                                    {
                                        field : "selectTypeDesc",
                                        title : '选配类型',
                                        width : 100
                                    }
                                ],
                                editable: false
                            });
                        </script>
                    </div>

                    <!---------------------------选配结果展示end ------------------------>
                </div>
            </div>
        </div>
    </div>

    <script type="text/javascript">

        //点击打开选配值窗口方法
        function chooseValue(chooseItemCode) {
            var platformId = "";
            if(viewModel.model.platformId!=null){
                platformId = viewModel.model.platformId;
            }else{
                kendo.ui.showInfoDialog({
                    message: '请先选择平台!'
                });
                return;
            }

            if(viewModel.model.relateGroup==null){
                kendo.ui.showInfoDialog({
                    message: '请先选择选配约束关系!'
                });
                return;
            }

            //塞可选项物料编码
            viewModel.model.set("chooseItemCode",chooseItemCode);

            var headerId = viewModel.model.headerId;

            var relateGroup = viewModel.model.relateGroup;

            //校验选配项是否选择正确,如果选配项已经选择过，提示确认要重新选择
            $.ajax({
                type: 'POST',
                url: '${base.contextPath}/hap/mam/select/header/validateChoose',
                dataType: "json",
                contentType: 'application/json',
                async: false,
                data:  kendo.stringify(viewModel.model),
                success: function (data) {
                    var rowData = data.rows || {};
                    if(data.success){
                        if(rowData[0].chooseFlag!=null&&rowData[0].chooseFlag){
                            kendo.ui.showConfirmDialog({
                                title: '提示',
                                message: '该选配项已选配，请确认要重新选择?'
                            }).done(function (e) {
                                if (e.button == 'OK') {
                                    //选择选配值窗口
                                    var chooseValueWindow = $("#chooseValueWindow").kendoWindow({
                                        title: '确定选配值',
                                        width: "780px",
                                        height :"450px",
                                        content:"${base.contextPath}/mam/mam_choose_value.html?platformId="+platformId+"&chooseItemCode="+chooseItemCode+"&headerId="+headerId+"&relateGroup="+relateGroup,
                                        actions: [
                                            "Pin",
                                            "Close"
                                        ],
                                        modal:true,
                                        visible:false,
                                        iframe:true,
                                        close: function() {
                                            //window 关闭  刷新 本页面的  Grid
                                            //$('#Grid').data('kendoGrid').dataSource.page(1);
                                        }
                                    }).data("kendoWindow");
                                    chooseValueWindow.center().open();
                                }
                            })
                        }else{
                            //选择选配值窗口
                            var chooseValueWindow = $("#chooseValueWindow").kendoWindow({
                                title: '确定选配值',
                                width: "780px",
                                height :"450px",
                                content:"${base.contextPath}/mam/mam_choose_value.html?platformId="+platformId+"&chooseItemCode="+chooseItemCode+"&headerId="+headerId+"&relateGroup="+relateGroup,
                                actions: [
                                    "Pin",
                                    "Close"
                                ],
                                modal:true,
                                visible:false,
                                iframe:true,
                                close: function() {
                                    //window 关闭  刷新 本页面的  Grid
                                    //$('#Grid').data('kendoGrid').dataSource.page(1);
                                }
                            }).data("kendoWindow");
                            chooseValueWindow.center().open();
                        }
                    }else{
                        kendo.ui.showErrorDialog({
                            message: data.message
                        });
                    }
                },
                error: function (data) {
                }
            });
        }

        $(document).ready(function() {
            $("#treeGrid").kendoGrid({
                dataSource: dataSource,
                height: '100%',
                resizable: true,
                scrollable: true,
                navigatable: true,
                page:false,
                columns: [
                    {
                        field: "optionDescription",
                        title: '可选项描述',
                        template : function (dataItem) {
                            return dataItem['sequenceCode']+":"+dataItem['optionDescription'];
                        },
                        width: 140
                    },
                    {
                        field: "vcode",
                        title: '选配值选择',
                        template: function (dataItem) {
                            return "<button id='button' type='button' style='width: 60px' onclick='chooseValue(\""+dataItem['optionCode']+"\")'>选择</button>";
                        },
                        width: 100
                    }
                ],
                editable: false
            }).data("kendoGrid");

            //动态设置分屏div的大小
            divFullScreen();//页面加载时全屏
            $(window).bind('resize', function (){
                divFullScreen();//最大化，还原窗口大小时DIV尺寸跟着变化，不过最好在CSS里给这个DIV加个min-width等于html,body的最小宽度。
            });

            //初始化分屏布局
            $("#main").kendoSplitter({
                orientation: "horizontal",
                panes: [ { size: "30%" }, {} ]
            });

            //绑定全局
            kendo.bind($('#main'), viewModel);
        });
    </script>
    <div id="chooseValueWindow"></div>
    </body>
</html>