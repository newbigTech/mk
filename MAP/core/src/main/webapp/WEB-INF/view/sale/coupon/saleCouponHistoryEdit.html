<#include "/include/header.html"/>
<body>
<script src="${base.contextPath}/common/code?saleChannel=HMALL.SALE_CHANNEL&saleType=HMALL.SALE_TYPE&saleYesNo=SYS.YES_NO" type="text/javascript"></script>

<script>
    var viewModel = kendo.observable({
        model:{},
        disabled:"true",
        containerFlag:1,
        resourceTypeData : [saleChannel,saleType,saleYesNo],


    });
    viewModel.model.set('coupon',{});

    var id='${RequestParameters.id}';
    var baseId='${RequestParameters.baseId}';
    var openType='${RequestParameters.type}';

    var addConditions="ADD_CONDITIONS";
    var addActions="ADD_ACTIONS";
    var addGroups="ADD_GROUPS";
    var addContainers="ADD_CONTAINERS";

</script>


<div id="content-container">
    <div class="panel" style="padding: 10px;">
        <div id="tabStrip">
            <ul>
                <li>字段编辑</li>
                <li>条件与结果</li>
            </ul>
            <div>
                <div class="panel" style="padding: 4px;">
                    <form class="form-horizontal" id="baseInfo" >

                        <div class="panel-body" >
                            <div class="col-sm-4">
                                <div class="form-group">
                                    <label class="col-sm-4 control-label">优惠券ID</label>
                                    <div class="col-sm-8">
                                        <input id="couponId"  disabled="true" style="background: rgb(222, 222, 222);;width: 100%;" type="text" placeholder="优惠券ID" style="width: 100%" data-bind="value:model.coupon.couponId"
                                               class="k-textbox">

                                    </div>
                                </div>
                            </div>

                            <div class="col-sm-4">
                                <div class="form-group">
                                    <label class="col-sm-4 control-label">优惠券名称</label>
                                    <div class="col-sm-8">
                                        <input id="couponName" disabled="true" name="优惠券名称"  style="background: rgb(222, 222, 222);;width: 100%;" type="text" placeholder="优惠券名称"  data-bind="value:model.coupon.couponName"
                                               data-role="优惠券名称" class="k-textbox">
                                        <!--<script>-->
                                        <!--kendo.bind($('#couponName'), viewModel);-->
                                        <!--</script>-->
                                        <span data-for="优惠券名称" class="k-invalid-msg"></span>
                                    </div>
                                </div>
                            </div>

                            <div class="col-sm-4">
                                <div class="form-group">
                                    <label class="col-sm-4 control-label">优惠券码</label>
                                    <div class="col-sm-8">
                                        <input id="couponCode" disabled="true" name="优惠券码" required type="text" placeholder="优惠券码"
                                               style="background: rgb(222, 222, 222);;width: 100%;" data-bind="value:model.coupon.couponCode" data-role="优惠券码" class="k-textbox">

                                    </div>
                                </div>
                            </div>


                            <div class="col-sm-4">
                                <div class="form-group">
                                    <label class="col-sm-4 control-label">优惠券面值</label>
                                    <div class="col-sm-8">
                                        <input id="benefit" disabled="true" type="text" required placeholder="优惠券面值"
                                               style="width: 100%" data-bind="value:model.coupon.benefit">
                                        <script>
                                            $("#benefit").kendoNumericTextBox({
                                                format: "n0",
                                                min:0
                                            });
                                        </script>

                                    </div>
                                </div>
                            </div>

                            <div class="col-sm-4">
                                <div class="form-group">
                                    <label class="col-sm-4 control-label">客户最大兑换数</label>
                                    <div class="col-sm-8">
                                        <input id="maxRedemptionPerCustomer"  disabled="true" type="text" placeholder="客户最大兑换数"
                                               style="width: 100%" data-bind="value:model.coupon.maxRedemptionPerCustomer">
                                        <script>
                                            $("#maxRedemptionPerCustomer").kendoNumericTextBox({
                                                format: "n0",
                                                min:0
                                            });
                                        </script>

                                    </div>
                                </div>
                            </div>

                            <div class="col-sm-4">
                                <div class="form-group">
                                    <label class="col-sm-4 control-label">卷最大兑换数</label>
                                    <div class="col-sm-8">
                                        <input id="maxRedemption" disabled="true"  type="text" placeholder="优惠卷最大兑换数"
                                               style="width: 100%"  data-bind="value:model.coupon.maxRedemption">
                                        <script>
                                            $("#maxRedemption").kendoNumericTextBox({
                                                format: "n0",
                                                min:0
                                            });
                                        </script>
                                        <!--<span data-for="卷最大兑换数" class="k-invalid-msg"></span>-->

                                    </div>
                                </div>
                            </div>

                            <div class="col-sm-4">
                                <div class="form-group">
                                    <label class="col-sm-4 control-label">使用渠道</label>
                                    <div class="col-sm-8">
                                        <input id="range" name="使用渠道" disabled="true" data-bind="value:model.coupon.range" placeholder="使用渠道"
                                               style="width: 100%;"  data-value-primitive="true"/>
                                        <script>
                                            viewModel.model.coupon.range='ALL';
                                            $("#range").kendoDropDownList({
                                                dataTextField  : "meaning",
                                                dataValueField : "value",
                                                dataSource     : saleChannel
                                            });
                                        </script>

                                    </div>
                                </div>
                            </div>

                            <div class="col-sm-4">
                                <div class="form-group">
                                    <label class="col-sm-4 control-label">发放类型</label>
                                    <div class="col-sm-8">
                                        <input id="type" disabled="true"  data-bind="value:model.coupon.type" placeholder="发放类型"
                                               style="width: 100%;"   data-value-primitive="true"/>
                                        <script>
                                            viewModel.model.coupon.type='COUPON_TYPE_01';
                                            $("#type").kendoDropDownList({
                                                dataTextField  : "meaning",
                                                dataValueField : "value",
                                                dataSource     : saleType
                                            });
                                        </script>

                                    </div>
                                </div>
                            </div>

                            <div class="col-sm-4">
                                <div class="form-group">
                                    <label class="col-sm-4 control-label">与促销叠加</label>
                                    <div class="col-sm-8">
                                        <input id="isOverlay" disabled="true" data-bind="value:model.coupon.isOverlay" placeholder="与促销叠加"
                                               style="width: 100%;"  data-value-primitive="true"/>
                                        <script>
                                            viewModel.model.coupon.isOverlay='Y';

                                            $("#isOverlay").kendoDropDownList({
                                                dataSource: [{meaning:"是",value:"Y"},{meaning:"否",value:"N"}],
                                                dataTextField: "meaning",
                                                dataValueField: "value"
//
                                            });
                                        </script>

                                    </div>
                                </div>
                            </div>


                            <div class="col-sm-8">
                                <div class="form-group">
                                    <label class="col-sm-2 control-label">有效开始</label>
                                    <div class="col-sm-10">
                                        <input id="startDate" disabled="true" required type="text" placeholder="有效开始时间"
                                               style="width: 40%"  data-bind="value:model.coupon.startDate">
                                        <input id="endDate" disabled="true"  type="text" placeholder="有效结束时间"
                                               style="width: 40%"  data-bind="value:model.coupon.endDate">
                                        <script>
                                            $("#startDate").kendoDateTimePicker({
                                                animation: false,
                                                format: "yyyy-MM-dd HH:mm:ss"

                                            });
                                            $("#endDate").kendoDateTimePicker({
                                                animation: false,
                                                format: "yyyy-MM-dd HH:mm:ss"

                                            });
                                        </script>
                                    </div>
                                </div>
                            </div>

                            <div class="col-sm-4">
                                <div class="form-group">
                                    <label class="col-sm-4 control-label">创建时间</label>
                                    <div class="col-sm-8">
                                        <input id="creationTime"  disabled="true" type="text" placeholder="创建时间" style="width: 100%" data-bind="value:model.coupon.creationTime">
                                        <script>
                                            $("#creationTime").kendoDateTimePicker({
                                                animation: false,
                                                format: "yyyy-MM-dd HH:mm:ss"

                                            });
                                        </script>
                                    </div>
                                </div>
                            </div>

                            <div class="col-sm-4">
                                <div class="form-group">
                                    <label class="col-sm-4 control-label">上次创建时间</label>
                                    <div class="col-sm-8">
                                        <input id="lastCreationTime" disabled="true" type="text" placeholder="创建时间" style="width: 100%" data-bind="value:model.coupon.lastCreationTime">
                                        <script>
                                            $("#lastCreationTime").kendoDateTimePicker({
                                                animation: false,
                                                format: "yyyy-MM-dd HH:mm:ss"

                                            });
                                        </script>
                                    </div>
                                </div>
                            </div>


                        </div>
                    </form>
                </div>

                <#include "/sale/record/saleRecord.html"/>

            </div>


            <div>
                <#include "/sale/conditions/saleConditionActionInclude.html"/>
            </div>
        </div>
    </div>

    <!--<div class="panel" style="padding: 0px;">-->
        <!--<div class="panel-footer text-right">-->
            <!--<span class="btn btn-success" id="query" onclick="submitResource()" type="submit"><i class="fa fa-plus"></i> 创建</span>-->
            <!--<span class="btn btn-primary" id="resetForm" onclick="returnResource()" type="button"><i class="fa fa-refresh"></i> 返回</span>-->

        <!--</div>-->
    <!--</div>-->
</div>

<div id="addTempWin"></div>
<div id="addTempConditionDataWin"></div>
<div id="addTempActionDataWin"></div>
<div id="productChooseWin"></div>


<script type="text/javascript">

    kendo.bind($('#content-container'),viewModel);
    var validator = $("#baseInfo").kendoValidator({
        invalidMessageType : "default"
    }).data("kendoValidator");

    $("#tabStrip").kendoTabStrip({
        animation: {
            close: {
                duration: 200,
                effects: "fadeOut"
            }
        }
    });
    var tabStrip = $("#tabStrip").kendoTabStrip().data("kendoTabStrip");
    tabStrip.select(0);


    if(openType=='EDIT')
    {
        $.ajax({
            url:"${base.contextPath}/sale/coupon/detail?id="+id,
            type:"GET",
            success:function (data) {
                if(data.success)
                {
                    var resp=data.resp;

                    if(resp.length>0) {
                        if(resp[0].coupon!=undefined) {
                            var coupon = resp[0].coupon;
                            viewModel.model.coupon.set('couponId',coupon.couponId);
                            viewModel.model.coupon.set('couponName',coupon.couponName);
                            viewModel.model.coupon.set('couponCode',coupon.couponCode);
                            viewModel.model.coupon.set('benefit',coupon.benefit);
                            viewModel.model.coupon.set('maxRedemptionPerCustomer',coupon.maxRedemptionPerCustomer);
                            viewModel.model.coupon.set('type',coupon.type);
                            viewModel.model.coupon.set('maxRedemption',coupon.maxRedemption);
                            viewModel.model.coupon.set('creationTime',timeToDate(coupon.creationTime));
                            viewModel.model.coupon.set('lastCreationTime',timeToDate(coupon.lastCreationTime));
                            viewModel.model.coupon.set('releaseId',timeToDate(coupon.releaseId));
                            viewModel.model.coupon.set('endDate',timeToDate(coupon.endDate));
                            viewModel.model.coupon.set('startDate',timeToDate(coupon.startDate));
                            viewModel.model.coupon.set('status',coupon.status);
                            viewModel.model.coupon.set('range',coupon.range);
                            viewModel.model.coupon.set('isOverlay',coupon.isOverlay);
                            viewModel.model.coupon.set('creationAt',coupon.creationAt);
                            viewModel.model.coupon.set('updateAt',coupon.updateAt);
                            viewModel.model.set('conditionsId',resp[0].conditionsId);
                            viewModel.model.set('containerFlag',resp[0].containerFlag);

                            appendConditions(resp[0].conditions||[],resp[0].actions||[],resp[0].groups||[],resp[0].containers||[])
                        }
                    }
                }else {
                    kendo.ui.showErrorDialog({
                        title:"错误",
                        message:data.msg
                    })
                }
            }
        })
    }


</script>
</body>
</html>