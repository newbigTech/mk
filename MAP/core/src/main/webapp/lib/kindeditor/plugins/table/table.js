KindEditor.plugin("table",function(b){var c=this,d="table",f=c.lang(d+"."),e="ke-zeroborder";function a(l,m,h){var j=0;for(var k=0,g=m.cells.length;k<g;k++){if(m.cells[k]==h){break}j+=m.cells[k].rowSpan-1}return h.cellIndex-j}c.plugin.table={prop:function(u){var t=['<div style="padding:10px 20px;">','<div class="ke-dialog-row">','<label for="keRows" style="width:90px;">'+f.cells+"</label>",f.rows+' <input type="text" id="keRows" class="ke-input-text ke-input-number" name="rows" value="" maxlength="4" /> &nbsp; ',f.cols+' <input type="text" class="ke-input-text ke-input-number" name="cols" value="" maxlength="4" />',"</div>",'<div class="ke-dialog-row">','<label for="keWidth" style="width:90px;">'+f.size+"</label>",f.width+' <input type="text" id="keWidth" class="ke-input-text ke-input-number" name="width" value="" maxlength="4" /> &nbsp; ','<select name="widthType">','<option value="%">'+f.percent+"</option>",'<option value="px">'+f.px+"</option>","</select> &nbsp; ",f.height+' <input type="text" class="ke-input-text ke-input-number" name="height" value="" maxlength="4" /> &nbsp; ','<select name="heightType">','<option value="%">'+f.percent+"</option>",'<option value="px">'+f.px+"</option>","</select>","</div>",'<div class="ke-dialog-row">','<label for="kePadding" style="width:90px;">'+f.space+"</label>",f.padding+' <input type="text" id="kePadding" class="ke-input-text ke-input-number" name="padding" value="" maxlength="4" /> &nbsp; ',f.spacing+' <input type="text" class="ke-input-text ke-input-number" name="spacing" value="" maxlength="4" />',"</div>",'<div class="ke-dialog-row">','<label for="keAlign" style="width:90px;">'+f.align+"</label>",'<select id="keAlign" name="align">','<option value="">'+f.alignDefault+"</option>",'<option value="left">'+f.alignLeft+"</option>",'<option value="center">'+f.alignCenter+"</option>",'<option value="right">'+f.alignRight+"</option>","</select>","</div>",'<div class="ke-dialog-row">','<label for="keBorder" style="width:90px;">'+f.border+"</label>",f.borderWidth+' <input type="text" id="keBorder" class="ke-input-text ke-input-number" name="border" value="" maxlength="4" /> &nbsp; ',f.borderColor+' <span class="ke-inline-block ke-input-color"></span>',"</div>",'<div class="ke-dialog-row">','<label for="keBgColor" style="width:90px;">'+f.backgroundColor+"</label>",'<span class="ke-inline-block ke-input-color"></span>',"</div>","</div>"].join("");var p,k;function n(){if(p){p.remove();p=null;k=null}}var z=c.createDialog({name:d,width:500,height:300,title:c.lang(d),body:t,beforeDrag:n,beforeRemove:function(){n();l.unbind()},yesBtn:{name:c.lang("yes"),click:function(O){var U=h.val(),Q=m.val(),F=j.val(),T=C.val(),J=v.val(),H=s.val(),S=x.val(),P=y.val(),N=g.val(),I=r.val(),G=b(l[0]).html()||"",R=b(l[1]).html()||"";if(U==0||!/^\d+$/.test(U)){alert(c.lang("invalidRows"));h[0].focus();return}if(Q==0||!/^\d+$/.test(Q)){alert(c.lang("invalidRows"));m[0].focus();return}if(!/^\d*$/.test(F)){alert(c.lang("invalidWidth"));j[0].focus();return}if(!/^\d*$/.test(T)){alert(c.lang("invalidHeight"));C[0].focus();return}if(!/^\d*$/.test(S)){alert(c.lang("invalidPadding"));x[0].focus();return}if(!/^\d*$/.test(P)){alert(c.lang("invalidSpacing"));y[0].focus();return}if(!/^\d*$/.test(I)){alert(c.lang("invalidBorder"));r[0].focus();return}if(B){if(F!==""){B.width(F+J)}else{B.css("width","")}if(B[0].width!==undefined){B.removeAttr("width")}if(T!==""){B.height(T+H)}else{B.css("height","")}if(B[0].height!==undefined){B.removeAttr("height")}B.css("background-color",R);if(B[0].bgColor!==undefined){B.removeAttr("bgColor")}if(S!==""){B[0].cellPadding=S}else{B.removeAttr("cellPadding")}if(P!==""){B[0].cellSpacing=P}else{B.removeAttr("cellSpacing")}if(N!==""){B[0].align=N}else{B.removeAttr("align")}if(I!==""){B.attr("border",I)}else{B.removeAttr("border")}if(I===""||I==="0"){B.addClass(e)}else{B.removeClass(e)}if(G!==""){B.attr("borderColor",G)}else{B.removeAttr("borderColor")}c.hideDialog().focus();return}var E="";if(F!==""){E+="width:"+F+J+";"}if(T!==""){E+="height:"+T+H+";"}if(R!==""){E+="background-color:"+R+";"}var M="<table";if(E!==""){M+=' style="'+E+'"'}if(S!==""){M+=' cellpadding="'+S+'"'}if(P!==""){M+=' cellspacing="'+P+'"'}if(N!==""){M+=' align="'+N+'"'}if(I!==""){M+=' border="'+I+'"'}if(I===""||I==="0"){M+=' class="'+e+'"'}if(G!==""){M+=' bordercolor="'+G+'"'}M+=">";for(var L=0;L<U;L++){M+="<tr>";for(var K=0;K<Q;K++){M+="<td>"+(b.IE?"&nbsp;":"<br />")+"</td>"}M+="</tr>"}M+="</table>";if(!b.IE){M+="<br />"}c.insertHtml(M);c.select().hideDialog().focus();c.addBookmark()}}}),w=z.div,h=b('[name="rows"]',w).val(3),m=b('[name="cols"]',w).val(2),j=b('[name="width"]',w).val(100),C=b('[name="height"]',w),v=b('[name="widthType"]',w),s=b('[name="heightType"]',w),x=b('[name="padding"]',w).val(2),y=b('[name="spacing"]',w).val(0),g=b('[name="align"]',w),r=b('[name="border"]',w).val(1),l=b(".ke-input-color",w);function i(F,E){E=E.toUpperCase();F.css("background-color",E);F.css("color",E==="#000000"?"#FFFFFF":"#000000");F.html(E)}i(b(l[0]),"#000000");i(b(l[1]),"");function q(F){n();if(!p||this!==k){var E=b(this),G=E.pos();p=b.colorpicker({x:G.x,y:G.y+E.height(),z:811214,selectedColor:b(this).html(),colors:c.colorTable,noColor:c.lang("noColor"),click:function(H){i(E,H);n()}});k=this}}l.click(q);h[0].focus();h[0].select();var B;if(u){return}B=c.plugin.getSelectedTable();if(B){h.val(B[0].rows.length);m.val(B[0].rows.length>0?B[0].rows[0].cells.length:0);h.attr("disabled",true);m.attr("disabled",true);var o,A=B[0].style.width||B[0].width,D=B[0].style.height||B[0].height;if(A!==undefined&&(o=/^(\d+)((?:px|%)*)$/.exec(A))){j.val(o[1]);v.val(o[2])}else{j.val("")}if(D!==undefined&&(o=/^(\d+)((?:px|%)*)$/.exec(D))){C.val(o[1]);s.val(o[2])}x.val(B[0].cellPadding||"");y.val(B[0].cellSpacing||"");g.val(B[0].align||"");r.val(B[0].border===undefined?"":B[0].border);i(b(l[0]),b.toHex(B.attr("borderColor")||""));i(b(l[1]),b.toHex(B[0].style.backgroundColor||B[0].bgColor||""));j[0].focus();j[0].select()}},cellprop:function(){var t=['<div style="padding:10px 20px;">','<div class="ke-dialog-row">','<label for="keWidth" style="width:90px;">'+f.size+"</label>",f.width+' <input type="text" id="keWidth" class="ke-input-text ke-input-number" name="width" value="" maxlength="4" /> &nbsp; ','<select name="widthType">','<option value="%">'+f.percent+"</option>",'<option value="px">'+f.px+"</option>","</select> &nbsp; ",f.height+' <input type="text" class="ke-input-text ke-input-number" name="height" value="" maxlength="4" /> &nbsp; ','<select name="heightType">','<option value="%">'+f.percent+"</option>",'<option value="px">'+f.px+"</option>","</select>","</div>",'<div class="ke-dialog-row">','<label for="keAlign" style="width:90px;">'+f.align+"</label>",f.textAlign+' <select id="keAlign" name="textAlign">','<option value="">'+f.alignDefault+"</option>",'<option value="left">'+f.alignLeft+"</option>",'<option value="center">'+f.alignCenter+"</option>",'<option value="right">'+f.alignRight+"</option>","</select> ",f.verticalAlign+' <select name="verticalAlign">','<option value="">'+f.alignDefault+"</option>",'<option value="top">'+f.alignTop+"</option>",'<option value="middle">'+f.alignMiddle+"</option>",'<option value="bottom">'+f.alignBottom+"</option>",'<option value="baseline">'+f.alignBaseline+"</option>","</select>","</div>",'<div class="ke-dialog-row">','<label for="keBorder" style="width:90px;">'+f.border+"</label>",f.borderWidth+' <input type="text" id="keBorder" class="ke-input-text ke-input-number" name="border" value="" maxlength="4" /> &nbsp; ',f.borderColor+' <span class="ke-inline-block ke-input-color"></span>',"</div>",'<div class="ke-dialog-row">','<label for="keBgColor" style="width:90px;">'+f.backgroundColor+"</label>",'<span class="ke-inline-block ke-input-color"></span>',"</div>","</div>"].join("");var p,k;function n(){if(p){p.remove();p=null;k=null}}var B=c.createDialog({name:d,width:500,height:220,title:c.lang("tablecell"),body:t,beforeDrag:n,beforeRemove:function(){n();l.unbind()},yesBtn:{name:c.lang("yes"),click:function(K){var D=j.val(),O=C.val(),J=u.val(),H=s.val(),N=z.val(),L=A.val(),E=m.val(),G=w.val(),I=r.val(),F=b(l[0]).html()||"",M=b(l[1]).html()||"";if(!/^\d*$/.test(D)){alert(c.lang("invalidWidth"));j[0].focus();return}if(!/^\d*$/.test(O)){alert(c.lang("invalidHeight"));C[0].focus();return}if(!/^\d*$/.test(I)){alert(c.lang("invalidBorder"));r[0].focus();return}h.css({width:D!==""?(D+J):"",height:O!==""?(O+H):"","background-color":M,"text-align":E,"vertical-align":G,"border-width":I,"border-style":I!==""?"solid":"","border-color":F});c.hideDialog().focus();c.addBookmark()}}}),v=B.div,j=b('[name="width"]',v).val(100),C=b('[name="height"]',v),u=b('[name="widthType"]',v),s=b('[name="heightType"]',v),z=b('[name="padding"]',v).val(2),A=b('[name="spacing"]',v).val(0),m=b('[name="textAlign"]',v),w=b('[name="verticalAlign"]',v),r=b('[name="border"]',v).val(1),l=b(".ke-input-color",v);function i(E,D){D=D.toUpperCase();E.css("background-color",D);E.css("color",D==="#000000"?"#FFFFFF":"#000000");E.html(D)}i(b(l[0]),"#000000");i(b(l[1]),"");function q(E){n();if(!p||this!==k){var D=b(this),F=D.pos();p=b.colorpicker({x:F.x,y:F.y+D.height(),z:811214,selectedColor:b(this).html(),colors:c.colorTable,noColor:c.lang("noColor"),click:function(G){i(D,G);n()}});k=this}}l.click(q);j[0].focus();j[0].select();var h=c.plugin.getSelectedCell();var o,y=h[0].style.width||h[0].width||"",g=h[0].style.height||h[0].height||"";if((o=/^(\d+)((?:px|%)*)$/.exec(y))){j.val(o[1]);u.val(o[2])}else{j.val("")}if((o=/^(\d+)((?:px|%)*)$/.exec(g))){C.val(o[1]);s.val(o[2])}m.val(h[0].style.textAlign||"");w.val(h[0].style.verticalAlign||"");var x=h[0].style.borderWidth||"";if(x){x=parseInt(x)}r.val(x);i(b(l[0]),b.toHex(h[0].style.borderColor||""));i(b(l[1]),b.toHex(h[0].style.backgroundColor||""));j[0].focus();j[0].select()},insert:function(){this.prop(true)},"delete":function(){var g=c.plugin.getSelectedTable();c.cmd.range.setStartBefore(g[0]).collapse(true);c.cmd.select();g.remove();c.addBookmark()},colinsert:function(g){var n=c.plugin.getSelectedTable()[0],p=c.plugin.getSelectedRow()[0],m=c.plugin.getSelectedCell()[0],k=m.cellIndex+g;for(var j=0,l=n.rows.length;j<l;j++){var o=n.rows[j],h=o.insertCell(k);h.innerHTML=b.IE?"":"<br />";k=a(n,o,h)}c.cmd.range.selectNodeContents(m).collapse(true);c.cmd.select();c.addBookmark()},colinsertleft:function(){this.colinsert(0)},colinsertright:function(){this.colinsert(1)},rowinsert:function(o){var l=c.plugin.getSelectedTable()[0],n=c.plugin.getSelectedRow()[0],h=c.plugin.getSelectedCell()[0],j;if(o===1){j=l.insertRow(n.rowIndex+(h.rowSpan-1)+o)}else{j=l.insertRow(n.rowIndex)}for(var k=0,g=n.cells.length;k<g;k++){var m=j.insertCell(k);if(o===1&&n.cells[k].colSpan>1){m.colSpan=n.cells[k].colSpan}m.innerHTML=b.IE?"":"<br />"}c.cmd.range.selectNodeContents(h).collapse(true);c.cmd.select();c.addBookmark()},rowinsertabove:function(){this.rowinsert(0)},rowinsertbelow:function(){this.rowinsert(1)},rowmerge:function(){var l=c.plugin.getSelectedTable()[0],m=c.plugin.getSelectedRow()[0],g=c.plugin.getSelectedCell()[0],n=m.rowIndex,i=n+g.rowSpan,k=l.rows[i];if(l.rows.length<=i){return}var h=a(l,m,g);if(k.cells.length<=h){return}var j=k.cells[h];if(g.colSpan!==j.colSpan){return}g.rowSpan+=j.rowSpan;k.deleteCell(h);c.cmd.range.selectNodeContents(g).collapse(true);c.cmd.select();c.addBookmark()},colmerge:function(){var k=c.plugin.getSelectedTable()[0],l=c.plugin.getSelectedRow()[0],g=c.plugin.getSelectedCell()[0],m=l.rowIndex,i=g.cellIndex,h=i+1;if(l.cells.length<=h){return}var j=l.cells[h];if(g.rowSpan!==j.rowSpan){return}g.colSpan+=j.colSpan;l.deleteCell(h);c.cmd.range.selectNodeContents(g).collapse(true);c.cmd.select();c.addBookmark()},rowsplit:function(){var n=c.plugin.getSelectedTable()[0],p=c.plugin.getSelectedRow()[0],m=c.plugin.getSelectedCell()[0],l=p.rowIndex;if(m.rowSpan===1){return}var k=a(n,p,m);for(var h=1,j=m.rowSpan;h<j;h++){var o=n.rows[l+h],g=o.insertCell(k);if(m.colSpan>1){g.colSpan=m.colSpan}g.innerHTML=b.IE?"":"<br />";k=a(n,o,g)}b(m).removeAttr("rowSpan");c.cmd.range.selectNodeContents(m).collapse(true);c.cmd.select();c.addBookmark()},colsplit:function(){var l=c.plugin.getSelectedTable()[0],n=c.plugin.getSelectedRow()[0],h=c.plugin.getSelectedCell()[0],j=h.cellIndex;if(h.colSpan===1){return}for(var k=1,g=h.colSpan;k<g;k++){var m=n.insertCell(j+k);if(h.rowSpan>1){m.rowSpan=h.rowSpan}m.innerHTML=b.IE?"":"<br />"}b(h).removeAttr("colSpan");c.cmd.range.selectNodeContents(h).collapse(true);c.cmd.select();c.addBookmark()},coldelete:function(){var m=c.plugin.getSelectedTable()[0],o=c.plugin.getSelectedRow()[0],h=c.plugin.getSelectedCell()[0],k=h.cellIndex;for(var l=0,g=m.rows.length;l<g;l++){var j=m.rows[l],n=j.cells[k];if(n.colSpan>1){n.colSpan-=1;if(n.colSpan===1){b(n).removeAttr("colSpan")}}else{j.deleteCell(k)}if(n.rowSpan>1){l+=n.rowSpan-1}}if(o.cells.length===0){c.cmd.range.setStartBefore(m).collapse(true);c.cmd.select();b(m).remove()}else{c.cmd.selection(true)}c.addBookmark()},rowdelete:function(){var j=c.plugin.getSelectedTable()[0],k=c.plugin.getSelectedRow()[0],g=c.plugin.getSelectedCell()[0],l=k.rowIndex;for(var h=g.rowSpan-1;h>=0;h--){j.deleteRow(l+h)}if(j.rows.length===0){c.cmd.range.setStartBefore(j).collapse(true);c.cmd.select();b(j).remove()}else{c.cmd.selection(true)}c.addBookmark()}};c.clickToolbar(d,c.plugin.table.prop)});